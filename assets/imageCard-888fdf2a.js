import{S as g,s as p,g as x,n as m,p as y,c as d,r as u,d as C,e as R,h as M,j as i}from"./index-f1810598.js";import{a as S,s as j,u as w,T as f,g as k,L as E}from"./handleAsync-07793997.js";import{u as _}from"./App-f63be5d2.js";class L extends g{constructor(t,s){super(),this.client=t,this.setOptions(s),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const r=this.options;this.options=this.client.defaultMutationOptions(t),p(r,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(s=this.currentMutation)==null||s.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const s={listeners:!0};t.type==="success"?s.onSuccess=!0:t.type==="error"&&(s.onError=!0),this.notify(s)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,s){return this.mutateOptions=s,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:x(),s={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=s}notify(t){m.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var s,r,c,n;(s=(r=this.mutateOptions).onSuccess)==null||s.call(r,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(c=(n=this.mutateOptions).onSettled)==null||c.call(n,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var a,l,o,h;(a=(l=this.mutateOptions).onError)==null||a.call(l,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(o=(h=this.mutateOptions).onSettled)==null||o.call(h,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(({listener:v})=>{v(this.currentResult)})})}}function b(e,t,s){const r=y(e,t,s),c=d({context:r.context}),[n]=u.useState(()=>new L(c,r));u.useEffect(()=>{n.setOptions(r)},[n,r]);const a=S(u.useCallback(o=>n.subscribe(m.batchCalls(o)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),l=u.useCallback((o,h)=>{n.mutate(o,h).catch(N)},[n]);if(a.error&&j(n.options.useErrorBoundary,[a.error]))throw a.error;return{...a,mutate:l,mutateAsync:a.mutate}}function N(){}const O=()=>{const e=d();return b({mutationFn:t=>R({file_path:t.file_path,movie_id:t.movie_id,aspect_ratio:t.aspect_ratio,height:t.height,width:t.width,type:t.type}),onSettled:()=>e.invalidateQueries(["collection"])})},F=()=>{const e=d();return b({mutationFn:t=>M(t),onSettled:()=>{e.invalidateQueries(["collection"])}})},A=()=>{const{data:e,isLoading:t,error:s}=w(["collection"],()=>C());return{collection:e,isLoading:t,error:s}},Q=e=>{const[t,s]=u.useState(e.inCollection),{mutate:r,isLoading:c}=O(),{mutate:n,isLoading:a}=F(),l=_(),o=u.useCallback(()=>{l(i.jsxs(i.Fragment,{children:[i.jsx(f,{type:e.type,path:e.file_path,aspectRatio:e.aspect_ratio,className:"w-full h-full object-contain"}),i.jsx("div",{className:"p-4 bg-black w-full text-center",children:i.jsx("a",{href:k("original",e.file_path),download:!0,target:"_blank",children:"Download"})})]}))},[l]);return i.jsxs("div",{className:"relative self-start",children:[i.jsx(f,{type:e.type,path:e.file_path,aspectRatio:e.aspect_ratio,className:"bg-gray-600"},e.file_path),i.jsxs("div",{className:`absolute top-0 left-0 w-full h-full opacity-0 hover:opacity-100
        transition-opacity flex flex-col items-end`,onClick:()=>o(),children:[i.jsx("div",{className:"bg-black bg-opacity-75 p-2 font-extralight italic",children:c||a?i.jsx(E,{}):t===!0?i.jsxs("div",{onClick:()=>n(e.file_path,{onSuccess:()=>s(!1)}),className:"cursor-pointer navlink text-red-600",children:["- ",i.jsx("span",{className:"text-xs",children:"Remove from collection"})]}):i.jsxs("div",{onClick:()=>r({file_path:e.file_path,movie_id:e.movie_id,aspect_ratio:e.aspect_ratio,height:e.height,width:e.width,type:e.type},{onSuccess:()=>s(!0)}),className:"cursor-pointer navlink text-emerald-600",children:["+ ",i.jsx("span",{className:"text-xs",children:"Add to collection"})]})}),i.jsxs("div",{className:"absolute bottom-0 left-0 bg-black bg-opacity-70",children:[e.width," x ",e.height]})]})]})};export{Q as I,A as u};
