import{S as v,s as y,g as x,n as f,p as w,d as C,e as h,r as c,h as M,i as R,k as j,j as i}from"./index-f2785db8.js";import{u as S,Q as _,a as O,s as k,g as E,T as m}from"./handleAsync-d1fec055.js";import{u as N,m as I}from"./App-08b7ce26.js";class L extends v{constructor(t,s){super(),this.client=t,this.setOptions(s),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const n=this.options;this.options=this.client.defaultMutationOptions(t),y(n,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(s=this.currentMutation)==null||s.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const s={listeners:!0};t.type==="success"?s.onSuccess=!0:t.type==="error"&&(s.onError=!0),this.notify(s)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,s){return this.mutateOptions=s,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:x(),s={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=s}notify(t){f.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var s,n,l,r;(s=(n=this.mutateOptions).onSuccess)==null||s.call(n,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(l=(r=this.mutateOptions).onSettled)==null||l.call(r,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var o,u,a,d;(o=(u=this.mutateOptions).onError)==null||o.call(u,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(a=(d=this.mutateOptions).onSettled)==null||a.call(d,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(({listener:p})=>{p(this.currentResult)})})}}function T(e,t,s){const n=w(e,t,s);return S(n,_)}function g(e,t,s){const n=C(e,t,s),l=h({context:n.context}),[r]=c.useState(()=>new L(l,n));c.useEffect(()=>{r.setOptions(n)},[r,n]);const o=O(c.useCallback(a=>r.subscribe(f.batchCalls(a)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),u=c.useCallback((a,d)=>{r.mutate(a,d).catch(Q)},[r]);if(o.error&&k(r.options.useErrorBoundary,[o.error]))throw o.error;return{...o,mutate:u,mutateAsync:o.mutate}}function Q(){}const A=()=>{const e=h();return g({mutationFn:t=>R({file_path:t.file_path,movie_id:t.movie_id,aspect_ratio:t.aspect_ratio,height:t.height,width:t.width,type:t.type}),onSettled:()=>e.invalidateQueries(["collection"])})},F=()=>{const e=h();return g({mutationFn:t=>j(t.file_path),onSettled:()=>{e.invalidateQueries(["collection"])}})},V=()=>{const{data:e,isLoading:t,error:s}=T(["collection"],()=>M());return{collection:e,isLoading:t,error:s}},B="/tmdb-image-browser/assets/heart_outline-11bf412f.svg",q="/tmdb-image-browser/assets/heart_filled-035ae030.svg",b=e=>{const[t,s]=c.useState(e.inCollection),{mutate:n,isLoading:l}=A(),{mutate:r,isLoading:o}=F();return i.jsx("div",{className:"w-8 h-8",children:i.jsx("div",{onClick:u=>{(t?r:n)({file_path:e.file_path,movie_id:e.movie_id,aspect_ratio:e.aspect_ratio,height:e.height,width:e.width,type:e.type},{onSuccess:()=>s(a=>!a)}),u.stopPropagation()},className:["cursor-pointer h-full",l||o&&"animate-pulse"].join(" "),children:i.jsx("img",{className:"w-full h-full",src:t?q:B})},`${e.file_path}.button.${t}`)})},D="/tmdb-image-browser/assets/download-5370f09c.svg",U=e=>i.jsxs("div",{className:"h-full w-full grid grid-rows-[1fr_4rem] md:grid-cols-[2rem_1fr] gap-2",children:[i.jsxs("div",{className:"flex flex-row gap-2 w-8 items-center order-last md:order-first md:flex-col md:w-auto md:h-12",children:[i.jsx("a",{href:E("original",e.file_path),download:!0,target:"_blank",children:i.jsx("img",{src:D,className:"w-full h-full"})}),i.jsx(b,{...e})]}),i.jsx(m,{type:e.type,path:e.file_path,aspectRatio:e.aspect_ratio,className:"flex-grow h-full w-full object-contain"})]}),H=e=>{const t=N(),s=c.useCallback(()=>{t(i.jsx(U,{...e}))},[t]);return i.jsxs(I.div,{initial:{opacity:0,y:"100%"},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.3},className:["relative self-start",e.type=="backdrop"&&"row-span-1 order-1",e.type=="poster"&&"row-span-2 order-2"].join(" "),children:[i.jsx(m,{type:e.type,path:e.file_path,aspectRatio:e.aspect_ratio,className:"bg-gray-600"},e.file_path),i.jsxs("div",{className:`absolute top-0 left-0 w-full h-full opacity-0
        hover:opacity-100 transition-opacity flex flex-col items-end
        cursor-pointer`,onClick:()=>s(),children:[i.jsx("div",{className:`dark:bg-black bg-white bg-opacity-75 p-2
        font-extralight italic`,children:i.jsx(b,{...e})}),i.jsxs("div",{className:`absolute bottom-0 left-0 dark:bg-black
        bg-opacity-70 bg-white`,children:[e.width," x ",e.height]})]})]})};export{H as I,V as a,T as u};
