var _=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)};var o=(e,t,s)=>(_(e,t,"read from private field"),s?s.call(e):t.get(e)),m=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},y=(e,t,s,i)=>(_(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s);var v=(e,t,s)=>(_(e,t,"access private method"),s);import{S as q,s as L,h as O,d as Q,n as R,e as A,Q as B,f as S,r as u,i as P,k as T,l as z,m as D,j as a,T as k,o as U,p as $}from"./index-99fbb267.js";var d,f,r,c,x,j,p,M,I,G=(I=class extends q{constructor(t,s){super();m(this,x);m(this,p);m(this,d,void 0);m(this,f,void 0);m(this,r,void 0);m(this,c,void 0);y(this,d,t),this.setOptions(s),this.bindMethods(),v(this,x,j).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var i;const s=this.options;this.options=o(this,d).defaultMutationOptions(t),L(this.options,s)||o(this,d).getMutationCache().notify({type:"observerOptionsUpdated",mutation:o(this,r),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&O(s.mutationKey)!==O(this.options.mutationKey)?this.reset():(i=o(this,r))==null||i.setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=o(this,r))==null||t.removeObserver(this)}onMutationUpdate(t){v(this,x,j).call(this),v(this,p,M).call(this,t)}getCurrentResult(){return o(this,f)}reset(){var t;(t=o(this,r))==null||t.removeObserver(this),y(this,r,void 0),v(this,x,j).call(this),v(this,p,M).call(this)}mutate(t,s){var i;return y(this,c,s),(i=o(this,r))==null||i.removeObserver(this),y(this,r,o(this,d).getMutationCache().build(o(this,d),this.options)),o(this,r).addObserver(this),o(this,r).execute(t)}},d=new WeakMap,f=new WeakMap,r=new WeakMap,c=new WeakMap,x=new WeakSet,j=function(){var s;const t=((s=o(this,r))==null?void 0:s.state)??Q();y(this,f,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},p=new WeakSet,M=function(t){R.batch(()=>{var s,i,n,h,l,g,w,N;if(o(this,c)&&this.hasListeners()){const b=o(this,f).variables,C=o(this,f).context;(t==null?void 0:t.type)==="success"?((i=(s=o(this,c)).onSuccess)==null||i.call(s,t.data,b,C),(h=(n=o(this,c)).onSettled)==null||h.call(n,t.data,null,b,C)):(t==null?void 0:t.type)==="error"&&((g=(l=o(this,c)).onError)==null||g.call(l,t.error,b,C),(N=(w=o(this,c)).onSettled)==null||N.call(w,void 0,t.error,b,C))}this.listeners.forEach(b=>{b(o(this,f))})})},I);function E(e,t){return A(e,B,t)}function F(e,t){const s=S(t),[i]=u.useState(()=>new G(s,e));u.useEffect(()=>{i.setOptions(e)},[i,e]);const n=u.useSyncExternalStore(u.useCallback(l=>i.subscribe(R.batchCalls(l)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),h=u.useCallback((l,g)=>{i.mutate(l,g).catch(X)},[i]);if(n.error&&P(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:h,mutateAsync:n.mutate}}function X(){}const H=()=>{const e=S();return F({mutationFn:t=>z({file_path:t.file_path,movie_id:t.movie_id,aspect_ratio:t.aspect_ratio,height:t.height,width:t.width,type:t.type}),onSuccess:()=>e.invalidateQueries({queryKey:["collection"],type:"all",refetchType:"active"})})},J=()=>{const e=S();return F({mutationFn:t=>D(t.file_path),onSuccess:()=>{e.invalidateQueries({queryKey:["collection"],type:"all",refetchType:"active"})}})},it=({query:e=void 0,limit:t=void 0}={})=>{const{data:s,isLoading:i,error:n}=E({queryKey:["collection",{query:e,limit:t}],queryFn:()=>T(e,t)});return{collection:s,isLoading:i,error:n}};function V(e){const t=typeof e=="string"?e:e.file_path;return E({queryKey:["collection",t],queryFn:()=>T(t,1).then(s=>(s==null?void 0:s[0])||!1)})}const W="/assets/heart_outline-11bf412f.svg",Y="/assets/heart_filled-035ae030.svg",K=e=>{const[t,s]=u.useState(e.inCollection),{mutate:i,isPending:n}=H(),{mutate:h,isPending:l}=J();return a.jsx("div",{className:"h-8 w-8",children:a.jsx("button",{disabled:e.loading||l||n,onClick:g=>{(t?h:i)({file_path:e.file_path,movie_id:e.movie_id,aspect_ratio:e.aspect_ratio,height:e.height,width:e.width,type:e.type},{onSuccess:()=>s(w=>!w)}),g.stopPropagation()},className:["h-full cursor-pointer",n||l&&"animate-pulse"].join(" "),children:a.jsx("img",{className:"h-full w-full",src:t?Y:W})},`${e.file_path}.button.${t}`)})},Z="/assets/download-5370f09c.svg",tt=e=>a.jsxs("div",{className:"relative top-0 grid h-full max-h-screen grid-rows-[1fr_3rem] gap-2",children:[a.jsx("div",{className:"flex items-center justify-center overflow-hidden",children:a.jsx(k,{type:e.type,path:e.file_path,className:"max-h-[100%] w-full max-w-[100%] object-contain",fullSize:!0})}),a.jsxs("div",{className:"dark:(invert-0) flex flex-row items-center gap-8 justify-self-center rounded-md bg-black p-4 text-white shadow-lg invert filter",children:[a.jsxs("p",{children:[e.width," X ",e.height]}),a.jsx("a",{href:U("original",e.file_path),download:!0,target:"_blank",children:a.jsx("img",{src:Z,className:"h-full w-full"})}),a.jsx(K,{...e})]})]}),ot=e=>{const{data:t,isLoading:s}=V(e.file_path),i=u.useMemo(()=>!!t,[t]),n=$(),h=u.useCallback(()=>{n(a.jsx(tt,{...e,inCollection:i}))},[n]);return a.jsxs("div",{className:["relative self-start",e.type=="backdrop"&&"order-1 row-span-1",e.type=="poster"&&"order-2 row-span-2"].join(" "),children:[a.jsx(k,{type:e.type,path:e.file_path,aspectRatio:e.aspect_ratio,className:"w-full bg-gray-600"},e.file_path),a.jsxs("div",{className:"absolute top-0 left-0 flex h-full w-full cursor-pointer flex-col items-end opacity-0 transition-opacity md:hover:opacity-100",onClick:()=>h(),children:[a.jsx("div",{className:"bg-opacity-75 bg-white p-2 font-extralight italic dark:bg-black",children:a.jsx(K,{...e,loading:s,inCollection:t!==void 0})}),a.jsxs("div",{className:"bg-opacity-70 absolute bottom-0 left-0 bg-white dark:bg-black",children:[e.width," x ",e.height]})]})]})},at=e=>a.jsx(a.Fragment,{children:a.jsx(k,{type:"backdrop",path:e.imagePath,className:"fixed top-0 left-0 -z-2 h-screen w-screen bg-cover object-cover",fullSize:!0})});export{ot as I,at as R,it as a,E as u};
