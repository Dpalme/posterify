import{S as p,s as x,g as y,n as f,p as w,e as C,f as d,r as c,h as M,i as j,k as R,j as i}from"./index-6845ba42.js";import{u as S,Q as _,a as k,s as N,T as m,g as O}from"./handleAsync-0e29c0ba.js";import{u as E}from"./App-0836eb2b.js";class I extends p{constructor(t,s){super(),this.client=t,this.setOptions(s),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const r=this.options;this.options=this.client.defaultMutationOptions(t),x(r,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(s=this.currentMutation)==null||s.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const s={listeners:!0};t.type==="success"?s.onSuccess=!0:t.type==="error"&&(s.onError=!0),this.notify(s)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,s){return this.mutateOptions=s,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:y(),s={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=s}notify(t){f.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var s,r,l,n;(s=(r=this.mutateOptions).onSuccess)==null||s.call(r,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(l=(n=this.mutateOptions).onSettled)==null||l.call(n,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var a,u,o,h;(a=(u=this.mutateOptions).onError)==null||a.call(u,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(o=(h=this.mutateOptions).onSettled)==null||o.call(h,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(({listener:v})=>{v(this.currentResult)})})}}function L(e,t,s){const r=w(e,t,s);return S(r,_)}function g(e,t,s){const r=C(e,t,s),l=d({context:r.context}),[n]=c.useState(()=>new I(l,r));c.useEffect(()=>{n.setOptions(r)},[n,r]);const a=k(c.useCallback(o=>n.subscribe(f.batchCalls(o)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),u=c.useCallback((o,h)=>{n.mutate(o,h).catch(T)},[n]);if(a.error&&N(n.options.useErrorBoundary,[a.error]))throw a.error;return{...a,mutate:u,mutateAsync:a.mutate}}function T(){}const Q=()=>{const e=d();return g({mutationFn:t=>j({file_path:t.file_path,movie_id:t.movie_id,aspect_ratio:t.aspect_ratio,height:t.height,width:t.width,type:t.type}),onSettled:()=>e.invalidateQueries(["collection"])})},A=()=>{const e=d();return g({mutationFn:t=>R(t.file_path),onSettled:()=>{e.invalidateQueries(["collection"])}})},P=()=>{const{data:e,isLoading:t,error:s}=L(["collection"],()=>M());return{collection:e,isLoading:t,error:s}},F="/assets/heart_outline-11bf412f.svg",B="/assets/heart_filled-035ae030.svg",b=e=>{const[t,s]=c.useState(e.inCollection),{mutate:r,isLoading:l}=Q(),{mutate:n,isLoading:a}=A();return i.jsx("div",{className:"w-8 h-8",children:i.jsx("div",{onClick:u=>{(t?n:r)({file_path:e.file_path,movie_id:e.movie_id,aspect_ratio:e.aspect_ratio,height:e.height,width:e.width,type:e.type},{onSuccess:()=>s(o=>!o)}),u.stopPropagation()},className:["cursor-pointer h-full",l||a&&"animate-pulse"].join(" "),children:i.jsx("img",{className:"w-full h-full",src:t?B:F})},`${e.file_path}.button.${t}`)})},q="/assets/download-5370f09c.svg",D=e=>i.jsxs("div",{className:`h-full w-full max-h-screen grid top-0 gap-2 relative
    grid-rows-[1fr_3rem]`,children:[i.jsx("div",{className:"flex items-center justify-center overflow-hidden",children:i.jsx(m,{type:e.type,path:e.file_path,className:"object-contain w-full max-h-[100%] max-w-[100%]"})}),i.jsxs("div",{className:`flex flex-row gap-8 items-center
      p-4 rounded-md shadow-lg justify-self-center
      invert filter dark:invert-0 bg-black text-white`,children:[i.jsxs("p",{children:[e.width," X ",e.height]}),i.jsx("a",{href:O("original",e.file_path),download:!0,target:"_blank",children:i.jsx("img",{src:q,className:"w-full h-full"})}),i.jsx(b,{...e})]})]}),X=e=>{const t=E(),s=c.useCallback(()=>{t(i.jsx(D,{...e}))},[t]);return i.jsxs("div",{className:["relative self-start",e.type=="backdrop"&&"row-span-1 order-1",e.type=="poster"&&"row-span-2 order-2"].join(" "),children:[i.jsx(m,{type:e.type,path:e.file_path,aspectRatio:e.aspect_ratio,className:"bg-gray-600 w-full"},e.file_path),i.jsxs("div",{className:`absolute top-0 left-0 w-full h-full opacity-0
        md:hover:opacity-100 transition-opacity flex flex-col items-end
        cursor-pointer`,onClick:()=>s(),children:[i.jsx("div",{className:`bg-white dark:bg-black bg-opacity-75 p-2
        font-extralight italic`,children:i.jsx(b,{...e})}),i.jsxs("div",{className:`absolute bottom-0 left-0 dark:bg-black
        bg-opacity-70 bg-white`,children:[e.width," x ",e.height]})]})]})};export{X as I,P as a,L as u};
